title xv6 kerneltrap

participantgroup #lightblue **user space**
                    participant proc1
                    participant proc2
                    end
participantgroup #lightgreen **kernel space**
                    participant usertrap
                    participant kerneltrap
                    participant scheduler
                    end
activecolor #green
activecolor scheduler #red
autoactivation on
activate proc1
rbox over proc1:-state RUNNING
rbox over proc2:-state RUNNABLE\n-suspending in kerneltrap
abox over proc1:<color:#red>**syscall**</color> 
proc1->usertrap:uservec
deactivate proc1
rbox over usertrap:-set kernelvec\n-syscall
abox over usertrap:<color:#red>**INT**</color>
usertrap->kerneltrap:kernelvec
deactivate usertrap
rbox over kerneltrap:-set proc1 state RUNNABLE
kerneltrap->scheduler:switch context to kernel thread
deactivate kerneltrap
rbox over scheduler:-lock proc2\n-set proc2 state RUNNING
scheduler->kerneltrap:switch context to proc2
deactivate scheduler
kerneltrap->usertrap:kernelret
deactivate kerneltrap
rbox over usertrap:-unlock proc2\n-set uservec
usertrap->proc2:userret
deactivate usertrap
